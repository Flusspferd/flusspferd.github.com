<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<head>
  <title>Flusspferd: Using Getopt</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <link href="/favicon.ico" rel="icon" type="image/ico" /> 
</head>
<BODY BGCOLOR="#FFFFFF">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="tutorials.html">Tutorials</a>&nbsp;&raquo&nbsp;<a class="el" href="js-tutorial.html">Using Flusspferd from Javascript</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="js-tutorial-getopt">Using Getopt </a></h1><p>Previous: <a class="el" href="js-tutorial-io.html">Using io</a></p>
<p>Flusspferd provides with getopt a module to parse command line parameters. The module has a C++ and a Javascript API and is also used by the Flusspferd Shell. See <a class="el" href="namespaceflusspferd.html#af886820a895e2f4484503421e51da34f" title="Parse the options.">flusspferd::getopt</a> for the reference.</p>
<p>Getopt is similar to alternatives known from other languages, like <a href="http://man.cx/getopt(3)">getopt(3)</a>. The getopt function takes a specification which options are supported and returns a list of parsed options. If no second parameter containing an Array of command line input is passed it is read from the environment.</p>
<p>The parameter specification is an object consisting of parameter names as properties. Those properties contain objects defining different aspects of the parameter. So the specification is basically a JSON structure. A very simple specification thus might look like this:</p>
<div class="fragment"><pre class="fragment">
var spec = {
  "help" : { },
  "version" : { },
  "foo" : { },
  "bar" : { }
};
</pre></div><p>getopt uses the following syntax for command line parameters:</p>
<p>Short option (one character long): <code>-S</code> </p>
<p>Long option: <code>--longoption</code> </p>
<p>If an option is short or long is determined by the length of the name. In our example all options are long options. It is recommended to always provide a descriptive long option and provide a short alias for common options. This brings us to the next point: Providing aliases. You can define several aliases for each option by adding an <code>"alias"</code> option to the subobjects:</p>
<div class="fragment"><pre class="fragment">
var spec = {
  "help" : {
     "alias" : "h"
  },
  "version" : {
     "alias" : "v"
  },
  "foo" : {
     "alias" : ["f", "F"]
  },
  "bar" : {
     "alias" : ["baz", "b" ]
  }
};
</pre></div><p>getopt also supports arguments to those options. The following syntaxes are supported:</p>
<p>Short option with argument: <code>-Sargument</code> or <code>-S</code> <code>argument</code> </p>
<p>Long option with argument: <code>--longoption=argument</code> or <code>--longoption</code> <code>argument</code> </p>
<p>You can specify that an option requires an argument with an <code>"argument"</code> parameter which should be either <code>"none"</code>, <code>"optional"</code> or <code>"required"</code> and you can define an argument type with <code>"argument_type"</code>. The <code>"argument_type"</code> is currently useful to improve the help output and for a bash completion script. We get back to this later.</p>
<div class="fragment"><pre class="fragment">
var spec = {
  "help" : {
     "alias" : "h"
  },
  "version" : {
     "alias" : "v"
  },
  "foo" : {
     "alias" : ["f", "F"],
     "argument" : "required",
     "argument_type" : "file"
  },
  "bar" : {
     "alias" : ["baz", "b" ],
     "argument" : "optional"
     // an argument_type does not need to be set
  }
};
</pre></div><p>Now we can parse the command line parameters with getopt:</p>
<div class="fragment"><pre class="fragment">
var getopt = require('getopt');
var result = getopt.getopt(spec);
</pre></div><p><code>result</code> now is an object containing the parsed options as property names which contain a list of arguments:</p>
<div class="fragment"><pre class="fragment">
{
  "option0" : [ "arg0", "arg1" ],
  "option1" : [ "arg0" ],
  "_" : [ "rest" ]
};
</pre></div><p>The property <code>"_"</code> is a special case containing the unparsed arguments.</p>
<p>Now you could process result. But getopt provides an even easier way by using callbacks. You can define callbacks inside the specifications:</p>
<div class="fragment"><pre class="fragment">
var spec = {
  "help" : {
    "alias" : "h",
    "callback" : function() {
      print("help");
      quit();
    }
  },
  "version" : {
    "alias" : "v",
    "callback" : function() {
      print("Version 1.0");
      quit();
    }
  },
  "foo" : {
     "alias" : ["f", "F"],
     "argument" : "required",
     "argument_type" : "file",
     "callback" : function(name, argument) {
       print("option '" + name + "' argument '" + argument + "'");
     }
  },
  "bar" : {
     "alias" : ["baz", "b" ],
     "argument" : "optional",
     "callback" : function(name, argument) {
       if(argument) {
         print("option '" + name + "' called with argument '" + argument + "'");
       }
       else {
         print("option '" + name + "' called without argument");
       }
     }
  }
};
</pre></div><p><code>"help"</code> is a common option and every program using command line options should provide it to list the supported options. getopt can even help with this option since getopt already know the supported options. There is a getopt_help function taking the parameter specification and generating a corresponding output. To improve the output you should add a <code>"doc"</code> property to all options.</p>
<div class="fragment"><pre class="fragment">
var spec = {
  "help" : {
    "alias" : "h",
    "doc" : "Displays this message.",
    "callback" : function() {
      print("usage: getopt-example.js [OPTIONS] ...");
      print(getopt.getopt_help(spec));
      quit();
    }
  },
  "version" : {
    "alias" : "v",
    "doc" : "Show version number.",
    "callback" : function() {
      print("Version 1.0");
      quit();
    }
  },
  "foo" : {
     "alias" : ["f", "F"],
     "argument" : "required",
     "argument_type" : "file",
     "doc" : "Foo!",
     "callback" : function(name, argument) {
       print("option '" + name + "' argument '" + argument + "'");
     }
  },
  "bar" : {
     "alias" : ["baz", "b" ],
     "argument" : "optional",
     "doc" : "Bar is the way to go.",
     "callback" : function(name, argument) {
       if(argument) {
         print("option '" + name + "' called with argument '" + argument + "'");
       }
       else {
         print("option '" + name + "' called without argument");
       }
     }
  }
};
</pre></div><p>getopt even provides functions to auto generate parts of a manpage (<a class="el" href="namespaceflusspferd.html#a74da0a2f3c7f7846cb45334d64e44a55" title="Returns a (nroff formated) manpage part to a corresponding getopt call.">flusspferd::getopt_man</a>) and bash completion script (<a class="el" href="namespaceflusspferd.html#a8ff93af3a909dea36b7af3ef8336276e" title="Returns the content of a bash_completion function.">flusspferd::getopt_bash</a>).</p>
<p>See <code>help/getopt-example.js</code> or <code>misc/replace-var.js</code> for examples on the usage of getopt with Javascript or take a look at <code>src/programs/flusspferd.cpp</code> for the getopt usage with C++.</p>
<p>Next: <a class="el" href="js-tutorial-curl.html">Using the cURL module</a> </p>
</div>
<hr size="1"><address style="text-align: right;">
<p>Contact us at team -AT- flusspferd -DOT- org or as described on our <a href="http://flusspferd.org/#contact">homepage</a>.</p>
<small>
Generated on Thu Feb 4 23:05:12 2010 for Flusspferd by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.6.1</small></address>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7744305-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
